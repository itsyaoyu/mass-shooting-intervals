---
title: 'Mass Shooting Intervals'
author: "Yao Yu"
date: "4/13/2020"
output: bookdown::pdf_document2
bibliography: bib.bib
link_citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(readxl)
library(janitor)
library(tinytex)
library(bookdown)
library(gt)
library(knitr)
library(rstanarm)
library(broom)
library(stargazer)
library(ggthemes)
library(cowplot)
```

# Abstract

Lin et al. (2018) found that the time interval between mass shootings has been drastic decreasing in the past three decades, suggesting that the rate of shootings are increasing. I managed to replicate most of the graphics from Lin et al. (2018) with the exception of table 1, where I was unable to recreate the exact zero-inflated poisson model. My extension broke down the interval trends between different venues of shootings showing in figure 2 of Lin et al. (2018). What I found was that the interval trend of mass school shootings remained relatively steady while the interval of mass workplace shootings drastically decreased and the overall interval also decreased. This finding suggests that the 2008 financial crisis might have played a major role in the decreasing interval of mass shootings.

This project can be found in my Github repository. [^1]

\newpage

# Introduction

Research surrounding mass shootings and gun violence has been rising in interest, especially among the youth, as survivors of mass school shootings have begun to enter college @davidhogg However, as mentioned in the paper, there is still relatively little research around mass shootings that have been published. One cause of this shortage of research might be due to the relatively small amount of data out there related to mass shootings. Out of the three goals in Lin's paper was to look at a few risk factors such as gun ownership and mental health to try and create a model to find a correlation between the factors and mass shootings. However, the results found were largely inconclusive. And one reason for this is just the small amount of data available surrounding mass shootings. 

In comparison with other crimes, the actual number of mass shootings is relatively small. Depending on how one defines as mass shootings, there are roughly only a handful each year. A report done by the Everytown for Gun Safety Support Fund identified 194 mass shootings from 2009 to 2018, with is about 19 shootings a year. @everytown However, the traumas of mass shootings extend far beyond just the victims and families directly affected by mass shootings. With the increased amount of media coverage around mass school shootings specifically, more and more students are fearing their safety at school. A 2018 survey conducted by the Pew Research Center found that 57 percent of respondents of U.S. teens ages 13 to 17 were somewhat worried or very worried about a shooting that could happen at their school. @pewresearch 

This increasing fear for safety among students is an alarming concern. With the importance of both mental and physical health for our children, there should be a lot more research going into mass shootings, their causes, and what we can do to decrease the number of them. In this project, I will be specifically using the time intervals between the shootings to determine if enough is being done to decrease the number of shootings and how the problem is worsening over time.

# Literature Review

This study resulted from limited published findings in the past and wanted to identify some risk factors associated with mass shootings. As a result, the authors wanted to answer three specific questions related to mass shootings in this paper. 1. "What are the population-level factors associated with the probability of mass shootings?" 2. "Is the incidence rate of mass shooting increasing during the past three decades?" 3. "Is the online media associated with the probable 'contagious effect'?" The specific factors looked at in this paper include: "state-level gun ownership rate, serious mental illness rate, poverty percentages, and gun law permissiveness". To evaluate if there was an increase in mass shootings in the past three decades, the authors looked at data regarding "mass shootings that occurred within the U.S. in the past 30 years". The authors of the paper defined mass shooting "as an act of firearm violence that resulted in at least four fatalities (not including the perpetrator), at the same time, or over a relatively short period of time in the case of shooting sprees". The contagious effect is like a copy cat effect, where if one mass shooting occurs, it promotes the increase of "copy cats" or more mass shootings in the time that follows.

The authors findings ultimately reached inconclusive evidence for looking at the relationship between risk factors and mass shootings. One of the main difficulties with looking at risk factors for mass shootings is the relatively small amount data on shootings that researchers have to look at. However, they did find the the interval between mass shootings has been steadily decreasing for the past three decades. Further, they found evidence of possible relationship between the increasing amount of media coverage of mass shootings and this interval decrease. However, the research done by Lin did not look at the specific number of social media posts mentioning mass shootings, only Google search results and Google trends. This is an area where research should be done because of the increasing popularity of social media, especially among the youth. Overall, the research done by Lin provided important information around the decreasing intervals which can be useful for further research to see how the interval trends have changed since the paper's publication.

In the overall category of research related to mass shootings, there have been two areas of main focus, continuing to look at what risk factors relate to mass shootings the most and domestic violence restraining order (DVRO) prohibition laws. In the focus of looking at risk factors, many other papers have also reached inconclusive evidence on many of the same factors that Lin looked at. Other papers have cited similar a similar issue with the lack of data to provide any substantive conclusions on risk factors. However, a recent Webster et al. (2020) paper found that more firearm purchaser licensing requirements are likely to reduce the number of mass shootings as it makes it more difficult for high-risk individuals to purchase guns. @webster Regarding the focus on DVRO, there was a lot of excitement around a paper by Zeoli et al. (2017) because he had found evidence that DVRO laws can significantly reduce the number of shootings related to domestic violence. @zeoli2017 This would have been a huge finding since many mass shootings are related to domestic violence. However, the paper by Zeoli et al. was later retracted shortly after due to errors within dates they used which led to the significance of DVRO laws to fade. @zeoli2018b

\newpage

# Replication

```{r figure 1, fig.height = 4}

# Using fig.height to scale the graphic correctly when it prints to pdf

# Reading in the data, using head(100) to get the 100 mass shootings that we
# want and filtering longitude > -140 to remove a shooting in Hawaii that is not
# present in the figure created in the paper. Clean names to get better column
# names.

data <- read_xlsx("raw-data/Mother Jones - Mass Shootings Database 1982 - 2018.xlsx") %>%
  head(100) %>%
  filter(longitude > -140) %>%
  clean_names()

# Getting a map of the United States using map_data, from the ggplot2 package

usa <- map_data("state")

data %>%
  ggplot() +
  geom_polygon(data = usa, aes(x = long, y = lat, group = group), fill = "white", colour = "black") +
  geom_point(data = data, aes(x = longitude, y = latitude, size = fatalities), color = "red", shape = 1, show.legend = FALSE) +
  scale_size(range = c(0, 12)) +
  theme_void() +
  labs(caption = "Figure 1. Geographic locations of shootings and respective fatalities (proportional to circle diameter) are presented.")

```

Figure 1 highlights all the mass shootings within the Mother Jones' dataset that was used in Lin's paper. The number of fatalities is proportional to the size of the circles.

\newpage

```{r figure 2}

# Reading in the data, using head(100) to get the 100 mass shootings that we
# want and clean names to get better column names. Using drop NA to remove one
# row with NA interval

data <- read_xlsx("raw-data/Mother Jones - Mass Shootings Database 1982 - 2018.xlsx") %>%
  head(100) %>%
  clean_names() %>%
  drop_na(interval) %>%
  mutate(date = as.Date(date))

dates <- as.Date(c("1982-07-01", "1988-07-01", "1994-07-01", "2000-07-01", "2006-07-01", "2012-07-01", "2018-07-01"))

# Making the graphic showing inter-incidence interval (days) versus Date of all
# the shootings. I can't seem to get the first date to show up though...been
# trying for an hour now.

data %>%
  ggplot(aes(x = date, y = interval)) +
  geom_point(shape = 1, size = 2) +
  scale_y_continuous(breaks = c(2, 5, 10, 20, 50, 100, 200, 500, 1000), trans = "log") +
  scale_x_date(breaks = dates, date_labels = "%m/%Y") +
  geom_smooth(method = "loess", formula = y ~ x, se = FALSE) +
  theme_classic() +
  labs(x = "Date",
       y = "Inter-incidence Interval (days)",
       caption = "Figure 2. Interval time between mass shootings and its GAM fit for trend is shown.")

```

Figure 2: Interval time between mass shootings and its GAM fit for trend is shown. This is also using the Mother Jones' data and it includes 100 mass shooting in the United States from January 1982 to May 2018. @paper

\newpage

```{r figure 3, fig.height = 4}

# Using fig.height bc cowplot and all other methods to display the two grpahics
# together were resizing the figures so it was ugly and difficult to clearly
# interpret

# Reading in the data, doing head(65) because the rows below that have NA values

data_3 <- read_xlsx("raw-data/Mother Jones - Mass Shootings Database 1982 - 2018.xlsx") %>%
  clean_names() %>%
  head(65) %>%
  mutate(log_media_density = as.numeric(log_media_density))

data_3 %>%
  ggplot(aes(x = log_media_density, y = log(interval))) +
  geom_point() +
  stat_smooth(method = "loess", formula = y ~ x, span = 1) +
  theme_classic() +
  labs(y = "Between-shooting time interval",
       x = "Media coverage density",
       tag = "A") +
  xlim(c(4, 11))

data_3 %>%
  ggplot(aes(x = log_transformed_search_interest, y = log(interval))) +
  geom_point() +
  stat_smooth(method = "loess", formula = y ~ x, span = 1) +
  theme_classic() +
  labs(y = "Between-shooting time interval",
       x = "Online search interest",
       tag = "B") +
  xlim(c(-2, 6))
```

Figure 3 shows two plots related to online interest of mass shootings. The first graph highlights the trend between shooting interval and media coverage density. The second graph shows the trend between shooting interval and online search interest.

\newpage

# Extension

I extended Lin et al. (2018) by taking into account the venue of the mass shootings from 1982 to 2018 and visualizing the trends between the three largest categories: School, Workplace, and Other. Additionally, I downloaded the updated mass shooting dataset from Mother Jones' @motherjones and created the same visualization with the three largest venues with data up to 2020.

## Venue Categories

Throughout Lin et al. (2018), the authors categorized every mass shooting in the data into one. However, the shooters' motive is an important factor when studying the causes for mass shootings and trying to prevent future shootings. Looking at all the venues of shootings categorized in this dataset, it would be natural to assume that the shooters' would have varying motives: Airport, Military, Other, Religious, School, and Workplace. For example, a shooter who attacks a religious venue might have racist motives while a shooter who attacks a school might have been acting on revenge against bullies. So, I decided to break down figure 2 by Lin et al. (2018) into three venue categories: School, Workplace, and Other. I chose these three because they were the three most common venues and the others all had five or less shootings. To keep the number of datapoints that same, I put these smaller venues into the category of Other.

```{r extension figure 4}

# Reading in the data as done for figure 2, but cleaning the venues to just
# three. Venues with less than 6 datapoints were coded along with Other

data <- read_xlsx("raw-data/Mother Jones - Mass Shootings Database 1982 - 2018.xlsx") %>%
  head(100) %>%
  clean_names() %>%
  mutate(date = as.Date(date)) %>%
  mutate(venue = case_when(
    venue %in% c("Airport", "Military", "Religious", "Other\r\n", "Other") ~ "Other",
    venue %in% c("\r\nWorkplace", "Workplace") ~ "Workplace",
    venue == "School" ~ "School"
  ))

# Function for recalculating intervals

calc_interval <- function(given_data, location) {
  
  # Filtering for specific venues
  
  data_temp <- given_data %>%
    filter(venue == !!location) %>%
    arrange(date)
  
  # Getting the dates to make a new column (for calculating difftime next)
  
  date_temp <- c(as.Date(NA), data_temp$date) %>%
    head(-1)
  
  # Calculating interval using difftime
  
  data_temp <- data_temp %>%
    mutate(date2 = date_temp,
         interval = as.numeric(difftime(date, date2, units = "days")))
  
  # Returning a tibble
  
  return(data_temp)
}

# Recalculating the intervals for all three venues

data_school <- calc_interval(data, "School")
data_workplace <- calc_interval(data, "Workplace")
data_other <- calc_interval(data, "Other")

# Binding the three venue tibbles together and removing NAs

data <- bind_rows(data_school, data_workplace, data_other) %>%
  drop_na(interval)

# Making dates for x-axis

dates <- as.Date(c("1982-07-01", "1988-07-01", "1994-07-01", "2000-07-01", "2006-07-01", "2012-07-01", "2018-07-01"))

# Making the graphic showing inter-incidence interval (days) versus Date of all
# the shootings. I can't seem to get the first date to show up though...been
# trying for an hour now.

data %>%
  ggplot(aes(x = date, y = interval, color = venue)) +
  geom_point(shape = 1, size = 2) +
  scale_y_continuous(breaks = c(2, 5, 10, 20, 50, 100, 200, 500, 1000), trans = "log") +
  scale_x_date(breaks = dates, date_labels = "%m/%Y") +
  geom_smooth(method = "loess", formula = y ~ x, se = FALSE) +
  theme_classic() +
  labs(x = "Date",
       y = "Inter-incidence Interval (days)",
       caption = "Figure 4. Interval time between mass shootings based on venue. Trends using method = 'loess'.",
       color = "Venue")

```

The results reveal some interesting information. When broken down into more specific categories, the trends show that not all venues have seen an equal downward trend in intervals between shootings. The trend looking at mass shootings at schools is perhaps the most intersting, as it shows only a slight decrease overall. This suggests that the number of mass shootings at schools today might not actually be much different than in the 80s. The trend seems to hover around every one year. On the other hand, the interval between mass shootings at workplaces has drastically fallen since around 2008 from one every few years to one every month in 2018. Before that, the interval seemed to be increasing from one every 200 days in 2000 to one every few years in 2008. This is an intersting trend because it might suggest a link between the financial crisis of 2008 and an increase in mass shootings at workplaces. Looking at shootings that occured in other venues, the trend aligns closer to the overall trend in figure 2 by Lin et al. (2018) of an overall decreasing trend in the interval between shootings.

## 2020 Data

Bringing in the new data on mass shootings from Mother Jones' @motherjones, I created the same three categories of venues and created a similar visualization. Since 2018, there has been no new mass shootings that occured at a school, so that trend does not chagne. The trend on workplace mass shootings has decreased slightly from every month to about every month and a half. This might suggest that the trend is flattening out. Since President Trump entered office in 2016, the unemployment rate has decreased significantly and the US economy has continued to grow (excluding the COVID-19 pandemic) @unemployment. This could be a potential cause of the flattening trend.

```{r extension figure 5, warning=FALSE}

# Setting warning to false because of duplicate column name, I renamed it to
# Venue.

# Reading in the data and cleaning just as I did previously.

new_data <- read_csv("raw-data/Mother Jones - Mass Shootings Database, 1982 - 2020.csv", col_types = cols(
  .default = col_character(),
  fatalities = col_double(),
  injured = col_double(),
  total_victims = col_double(),
  latitude = col_double(),
  longitude = col_double(),
  year = col_double()
)) %>%
  mutate(date = as.Date(date, tryFormats = "%m/%d/%Y"),
         venue = location_1) %>%
  select(-location_1) %>%
  mutate(venue = case_when(
    venue %in% c("Airport", "Military", "Religious", "Other\n", "Other") ~ "Other",
    venue %in% c("\nWorkplace", "Workplace") ~ "Workplace",
    venue == "School" ~ "School"
  ))

# Recalculating the intervals for all three venues

data_school <- calc_interval(new_data, "School")
data_workplace <- calc_interval(new_data, "Workplace")
data_other <- calc_interval(new_data, "Other")

# Binding the three venue tibbles together and removing NAs

data <- bind_rows(data_school, data_workplace, data_other) %>%
  drop_na(interval)

# Making dates for x-axis

dates <- as.Date(c("1982-07-01", "1988-07-01", "1994-07-01", "2000-07-01", "2006-07-01", "2012-07-01", "2018-07-01"))

# Making the graphic showing inter-incidence interval (days) versus Date of all
# the shootings. I can't seem to get the first date to show up though...been
# trying for an hour now.

data %>%
  ggplot(aes(x = date, y = interval, color = venue)) +
  geom_point(shape = 1, size = 2) +
  scale_y_continuous(breaks = c(2, 5, 10, 20, 50, 100, 200, 500, 1000), trans = "log") +
  scale_x_date(breaks = dates, date_labels = "%m/%Y") +
  geom_smooth(method = "loess", formula = y ~ x, se = FALSE) +
  theme_classic() +
  labs(x = "Date",
       y = "Inter-incidence Interval (days)",
       caption = "Figure 5. Interval time between mass shootings based on venue. Trends using method = 'loess'.",
       color = "Venue")



```
\newpage

# Discussion

\newpage

# Bibliography

<div id="refs"></div>

\newpage

# Appendix {-}

```{r table 1, results = "asis"}

# This is my attempt to recreate the regression model output in figure 1. I've
# been having trouble replicating the exact model because of missing/unknow data
# regarding FS/S (firearm suicides) that is not in the dataset given.

data_1 <- read_xlsx("raw-data/Gun ownership data.xlsx")

# Close! However, this model is not zero-inflated and it does not have population as an offset

fit_1 <- stan_glm(Massshooting ~ Gun_ownership_rate + SeriousMentalIllness + pov_percentage + gun_laws, data = data_1, family = poisson, refresh = FALSE)

# https://stats.idre.ucla.edu/r/dae/zip/ This was my attempt to replicate the
# zero-inflated poisson model. Unsuccessful. Using the pscl package

# fit_2 <- zeroinfl(Massshooting ~ Gun_ownership_rate + SeriousMentalIllness + pov_percentage + gun_laws, data = data_1, subset = pop_2000)

stargazer(data.frame(fit_1), type = "latex",
          summary.stat = c("mean", "sd"),
          covariate.labels = c("Intercept", "FS/S", "Serious mental disorder rate", "Poverty rate", "Gun law permissiveness"),
          title = "Effect of Treatment, Time Length, and their Interaction on Change in attitude")

# EXPLAIN DIFFERENCES

```

Table 1: This is a poisson model I created in attempt to replicate the zero-inflated poisson model in the paper. I was unable to fully replicate the model as the code for this paper was not made publicly available.

```{r table 2}

# Making the table using the formula they used

prob_data <- tibble(months = c(1, 2, 3, 6, 9, 12)) %>%
  mutate(constant_rate = 1 - exp(-0.227 * months),
         regression_rate = 1 - exp(-0.468 * months)) 

# Using gt to make a nice table.

round(prob_data, digits = 3) %>%
  gt() %>%
  cols_align("center") %>%
  cols_label(
    months = "Within months (t)",
    constant_rate = "P of a shooting Using constant rate",
    regression_rate = "P of a shooting Using regression model"
  )
```

Table 2: This table predicts the probability of at least one mass shooting within the given number of months using the trend the authors found in the paper


[^1]: [GitHub](https://github.com/itsyaoyu/1006_milestone)